!function(t){var e={};function r(s){if(e[s])return e[s].exports;var i=e[s]={i:s,l:!1,exports:{}};return t[s].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=e,r.d=function(t,e,s){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(s,i,function(e){return t[e]}.bind(null,i));return s},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){"use strict";r.r(e);function s(t){return t[t.length-1]}function i(t){return t.length>1}var a=async(t,e)=>{if("compact"==e)var r=!0,a=!1;else if("minimum"==e)r=!1,a=!0;else r=!1,a=!1;try{const e=encodeURI(t);console.log("Product details initiated");try{var l=await(await fetch("https://www.flipkart.com/"+e)).text();if(i((l=l.replace(/&amp;/g,"&")).split("for has been moved or deleted")))throw"Link provided doesn't corresponds to any product"}catch(t){return JSON.stringify({error_message:t,possible_solution:"Validate your link and try removing https://www.flipkart.com from your product link",bug_report:"https://github.com/dvishal485/flipkart-scraper-api/issues"})}var p,n=null,o=null,c=null,u=null,d=[];if(!(l.split("<h1").length>1))throw"Can't find the product page";u=l.split("<h1")[1].split("</span>")[0].split('">')[2].replace(/<!-- -->/g,"").replace(/&nbsp;/g,""),o=l.split("<h1")[1].split(">₹")[1].split("</div>")[0];var h=l.split("<h1")[1].split(">₹")[2].split("</div>")[0].split("\x3c!-- --\x3e"),g=i(h),m=l.split("<h1")[1].split(">₹"+o)[0].split("fk-cp-zion/img/fa_62673a.png"),f=i(m);o=parseInt(o.replace(/,/g,"")),p=g?parseInt(h[1].replace(/,/g,"")):o,"/"==(c=s(s((s(l.split("product.share.pp")[0].split('"url":"'))+"product.share.pp").split(" ")).split('"')))[0]&&(c="http://www.flipkart.com"+c),String(c).toLowerCase().split("login").length>1&&(c="http://www.flipkart.com/"+e);var v=new URL(c);v.searchParams.delete("_appId"),v.searchParams.delete("_refId"),v.searchParams.delete("cmpid"),c=v.toString();var w=i(l.split("This item is currently out of stock</div>")),y=l.split("Highlights")[1].split("</ul>")[0].replace(/<\/li>/g,"").split("<li");if(i(y))for(k=1;k<y.length;k++)d.push(y[k].split(">")[1]);var _=m[0].split("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMyIgaGVpZ2h0PSIxMiI+PHBhdGggZmlsbD0iI0ZGRiIgZD0iTTYuNSA5LjQzOWwtMy42NzQgMi4yMy45NC00LjI2LTMuMjEtMi44ODMgNC4yNTQtLjQwNEw2LjUuMTEybDEuNjkgNC4wMSA0LjI1NC40MDQtMy4yMSAyLjg4Mi45NCA0LjI2eiIvPjwvc3ZnPg==");if(i(_))n=s(_[0].split('">')).split("<")[0];if(a)return JSON.stringify({name:u.replace(/&#x27;/g,"'"),current_price:o,original_price:p,discounted:g,discount_percent:parseInt(100*(1-o/p)),rating:n,in_stock:!w,f_assured:f,share_url:c,highlights:d},null,2);var k,P=[],b=l.split("Specifications</div>")[1].split(">Safe and Secure Payments.")[0].replace(/&amp;/g,"&").split("</div><table");for(k=1;k<b.length;k++){var I,M="",S=[],x=s(b[k-1].split(">")),C=b[k].split("</td>");for(I=1;I<C.length;I+=2){var L=s(C[I-1].split(">")),N=s(C[I].split("</li>")[0].split(">"));null!=L&&""!=L&&1==N.split("<").length&&""!=N&&(r?M+=L+" : "+N+"; ":S.push({property:L,value:N}))}S!=[]&&(r?P.push({title:x,details:M}):P.push({title:x,details:S}))}return JSON.stringify({name:u.replace(/&#x27;/g,"'"),current_price:o,original_price:p,discounted:g,discount_percent:parseInt(100*(1-o/p)),rating:n,in_stock:!w,f_assured:f,share_url:c,highlights:d,specs:P},null,2)}catch(t){return JSON.stringify({error:"Couldn't fetch information : "+t.message,possible_solution:"Don't lose hope, contact the support",bug_report:"https://github.com/dvishal485/flipkart-scraper-api/issues"})}};const l=t=>{var e=new URL(t.replace(/amp;/g,""));return e.searchParams.delete("_appId"),e.searchParams.delete("_refId"),e.searchParams.delete("cmpid"),e.searchParams.delete("marketplace"),e.searchParams.delete("ppt"),e.searchParams.delete("lid"),e.searchParams.delete("store"),e.searchParams.delete("spotlightTagId"),e.searchParams.delete("q"),e.searchParams.delete("srno"),e.searchParams.delete("otracker"),e.searchParams.delete("fm"),e.searchParams.delete("iid"),e.searchParams.delete("ppn"),e.searchParams.delete("ssid"),e.searchParams.delete("qH"),e.toString()};var p=async t=>{const e="https://www.flipkart.com/search?marketplace=FLIPKART&q="+t;console.log("Search initiated : "+e);var r,s=await(await fetch(e)).text(),i=(s=s.replace(/style="color:#000000;font-size:14px;font-style:normal;font-weight:700">₹/g,">Rs. ")).split(">₹"),a=[],p=null,n=!1;for(r=1;r<i.length;r++)try{var o,c=null,u=null,d=null,h=!1,g=null,m=null,f=i[r].split("</div>")[0].replace(/,/g,"");if(o=parseInt(f),1==f.split("</option>").length){try{(m=(g=i[r-1].split("</a>"))[g.length-2].split('target="_blank"')).length>1&&(u="https://www.flipkart.com"+m[1].split('href="')[1].split('"')[0],d=m[1].split('href="')[1].split('"')[1].split(">")[1],p="A")}catch(t){}if(c=parseInt(o),""==d||null==d){g=null,m=null;try{"C"!=p&&"D"!=p||(r++,n=!0),g=i[r-2].split("<a"),p="B",1==g.length&&(g=i[r-1].split("<a"),p="C"),(m=g[g.length-1].split('target="_blank"')).length>1&&(u="https://www.flipkart.com"+m[1].split('href="')[1].split('"')[0],d=m[1].split('href="')[1].split('"col col-7-12">')[1].split("</div>")[0].split(">")[1]),n&&(r--,n=!1,p="D")}catch(t){}if(""==d||null==d);else{if(r+1!=i.length)(h=(v=i[r+1].split("</div>")[0].replace(/,/g,"").split("\x3c!-- --\x3e")).length>1)&&(r++,c=parseInt(v[1]));a.push({name:d.replace(/&#x27;/g,"'"),link:l(u),current_price:o,original_price:c,discounted:h})}}else{var v;if(r+1!=i.length)(h=(v=i[r+1].split("</div>")[0].replace(/,/g,"").split("\x3c!-- --\x3e")).length>1)&&(r++,c=parseInt(v[1]));a.push({name:d.replace(/&#x27;/g,"'"),link:l(u),current_price:o,original_price:c,discounted:h})}}else s=s.replace("₹","Rs."),console.log("Ignoring amount "+o+" : Suspected to be dropdown menu item")}catch(t){console.log(t.message)}return JSON.stringify({result:a},null,2)};var n=t=>({"Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"*","Access-Control-Allow-Methods":"GET","Access-Control-Max-Age":"86400","Content-Type":"application/json","Cache-Control":"no-cache, no-store, must-revalidate","Your-IP":t.get("cf-connecting-ip"),"Your-Country":t.get("CF-IPCountry"),Host:t.get("host"),"Made-By":atob("VmlzaGFsIERhcyBodHRwczovL2dpdGh1Yi5jb20vZHZpc2hhbDQ4NQ==")});function o(t){return t[t.length-1]}function c(t){return t.length>1}function u(t,e,r){var s=!1;e=e.toLowerCase(),t=t.toLowerCase();for(var i=0;i<r.length;i++)if(r[i]=r[i].toLowerCase(),c(t.split(r[i]))||c(e.split(r[i])))return s=!0;return s}var d=async t=>{try{var e=t.split("/")[0];t=t.split(e+"/")[1];var r=e.split("&");const L=encodeURI(t);console.log("Product details initiated");try{var s=await(await fetch("https://www.flipkart.com/"+L)).text();if(c((s=s.replace(/&amp;/g,"&")).split("for has been moved or deleted")))throw"Link provided doesn't corresponds to any product"}catch(t){return JSON.stringify({error_message:t,possible_solution:"Validate your link and try removing https://www.flipkart.com from your product link",bug_report:"https://github.com/dvishal485/flipkart-scraper-api/issues"})}var i,a=null,l=null,p=null,n=null,d=[],h=(n=s.split("<h1")[1].split("</span>")[0].split('">')[2].replace(/<!-- -->/g,"").replace(/&nbsp;/g,""),l=s.split("<h1")[1].split(">₹")[1].split("</div>")[0],s.split("<h1")[1].split(">₹")[2].split("</div>")[0].split("\x3c!-- --\x3e")),g=c(h),m=s.split("<h1")[1].split(">₹"+l)[0].split("fk-cp-zion/img/fa_62673a.png"),f=c(m);l=parseInt(l.replace(/,/g,"")),i=g?parseInt(h[1].replace(/,/g,"")):l,"/"==(p=o(o((o(s.split("product.share.pp")[0].split('"url":"'))+"product.share.pp").split(" ")).split('"')))[0]&&(p="http://www.flipkart.com"+p),String(p).toLowerCase().split("login").length>1&&(p="http://www.flipkart.com/"+L);var v=new URL(p);v.searchParams.delete("_appId"),v.searchParams.delete("_refId"),v.searchParams.delete("cmpid"),p=v.toString();var w=c(s.split("This item is currently out of stock</div>")),y=s.split("Highlights")[1].split("</ul>")[0].replace(/<\/li>/g,"").split("<li");if(c(y))for(k=1;k<y.length;k++)d.push(y[k].split(">")[1]);var _=m[0].split("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMyIgaGVpZ2h0PSIxMiI+PHBhdGggZmlsbD0iI0ZGRiIgZD0iTTYuNSA5LjQzOWwtMy42NzQgMi4yMy45NC00LjI2LTMuMjEtMi44ODMgNC4yNTQtLjQwNEw2LjUuMTEybDEuNjkgNC4wMSA0LjI1NC40MDQtMy4yMSAyLjg4Mi45NCA0LjI2eiIvPjwvc3ZnPg==");if(c(_))a=o(_[0].split('">')).split("<")[0];var k,P=[],b=[],I=s.split("Specifications</div>")[1].split(">Safe and Secure Payments.")[0].replace(/&amp;/g,"&").split("</div><table");for(k=1;k<I.length;k++){var M,S=I[k].split("</td>");for(M=1;M<S.length;M+=2){var x=o(S[M-1].split(">")),C=o(S[M].split("</li>")[0].split(">"));null==x&&""==x||u(C,x,r)&&b.push({property:x,value:C})}0!=b.length&&(P=b)}return JSON.stringify({name:n.replace(/&#x27;/g,"'"),current_price:l,original_price:i,discounted:g,discount_percent:parseInt(100*(1-l/i)),rating:a,in_stock:!w,f_assured:f,share_url:p,highlights:d,desired_specs:P},null,2)}catch(t){return JSON.stringify({error:"Couldn't fetch information : "+t.message,possible_solution:"Don't lose hope, contact the support",bug_report:"https://github.com/dvishal485/flipkart-scraper-api/issues"})}};addEventListener("fetch",t=>{t.respondWith(async function(t){const e=n(t.headers),r=new URL(t.url).pathname;return"GET"==t.method?r.startsWith("/search/")?new Response(await p(r.replace("/search/","")),{status:200,headers:e}):r.startsWith("/product/min/")?new Response(await a(r.replace("/product/min/",""),"minimum"),{status:200,headers:e}):r.startsWith("/product/compact/")?new Response(await a(r.replace("/product/compact/",""),"compact"),{status:200,headers:e}):r.startsWith("/product/")?new Response(await a(r.replace("/product/",""),"general"),{status:200,headers:e}):r.startsWith("/property/")?new Response(await d(r.replace("/property/",""),"general"),{status:200,headers:e}):new Response(JSON.stringify([{name:"flipkart-scraper",description:"API to scrapes search result and product details from flipkart",version:2.1,author:"Vishal Das",email:"dvishal485@gmail.com",telegram:"@dvishal485",documentation:"https://dvishal485.github.io/flipkart-scraper-api/",usage:{search_api:"https://flipkart.dvishal485.workers.dev/search/<product_name>",product_api:"https://flipkart.dvishal485.workers.dev/product/<product_link_argument>",product_min_api:"https://flipkart.dvishal485.workers.dev/product/min/<product_link_argument>",product_compact_api:"https://flipkart.dvishal485.workers.dev/product/compact/<product_link_argument>",product_search_specs:"https://flipkart.dvishal485.workers.dev/property/<specs_to_search>/<product_link_argument>"},examples:{search_api:"https://flipkart.dvishal485.workers.dev/search/smartwatch",product_api:"https://flipkart.dvishal485.workers.dev/product/dl/huami-amazfit-bip-u-smartwatch/p/itmc6ae7a0e9f440?pid=SMWFY7PPGQTEH2BZ",product_min_api:"https://flipkart.dvishal485.workers.dev/product/min/dl/huami-amazfit-bip-u-smartwatch/p/itmc6ae7a0e9f440?pid=SMWFY7PPGQTEH2BZ",product_compact_api:"https://flipkart.dvishal485.workers.dev/product/compact/dl/huami-amazfit-bip-u-smartwatch/p/itmc6ae7a0e9f440?pid=SMWFY7PPGQTEH2BZ",product_search_specs:"https://flipkart.dvishal485.workers.dev/property/battery&display/dl/huami-amazfit-bip-u-smartwatch/p/itmc6ae7a0e9f440?pid=SMWFY7PPGQTEH2BZ"}}],null,2),{status:200,headers:e}):Response.redirect("https://github.com/dvishal485/flipkart-scraper/",301)}(t.request))})}]);